{"version":3,"file":"vue3-calendar-heatmap.es.js","sources":["../src/components/Heatmap.ts","../src/components/CalendarHeatmap.vue","../src/components/CalendarHeatmap.vue","../src/index.ts"],"sourcesContent":["export interface Value {\r\n\tdate: Date | string;\r\n\tcount: number;\r\n}\r\n\r\nexport interface Activity {\r\n\tcount: number;\r\n\tcolorIndex: number;\r\n}\r\n\r\nexport type Activities = Map<string, Activity>;\r\n\r\nexport interface CalendarItem {\r\n\tdate: Date;\r\n\tcount?: number;\r\n\tcolorIndex: number;\r\n}\r\n\r\nexport type Calendar = CalendarItem[][];\r\n\r\nexport interface Month {\r\n\tvalue: number;\r\n\tindex: number;\r\n}\r\n\r\nexport interface Locale {\r\n\tmonths: string[];\r\n\tdays: string[];\r\n\ton: string;\r\n\tless: string;\r\n\tmore: string;\r\n}\r\n\r\nexport type TooltipFormatter = (item: CalendarItem, unit: string) => string;\r\n\r\nexport class Heatmap {\r\n\r\n\tstatic readonly DEFAULT_RANGE_COLOR_LIGHT = [ '#ebedf0', '#dae2ef', '#c0ddf9', '#73b3f3', '#3886e1', '#17459e' ];\r\n\tstatic readonly DEFAULT_RANGE_COLOR_DARK  = [ '#1f1f22', '#1e334a', '#1d466c', '#1d5689', '#1d69ac', '#1B95D1' ];\r\n\t// other color candidates\r\n\t// static readonly DEFAULT_RANGE_COLOR_LIGHT = [ '#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK  = [ '#161b22', '#0e4429', '#006d32', '#26a641', '#39d353' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#011526', '#012E40', '#025959', '#02735E', '#038C65' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#161b22', '#015958', '#008F8C', '#0CABA8', '#0FC2C0' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#012030', '#13678A', '#45C4B0', '#9AEBA3', '#DAFDBA' ];\r\n\tstatic readonly DEFAULT_LOCALE: Locale = {\r\n\tmonths: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],\r\n\tdays: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],\r\n\tless: 'Низкая',\r\n\tmore: 'Высокая',\r\n\ton: 'на',\r\n};\r\n\tstatic readonly DEFAULT_TOOLTIP_UNIT   = 'contributions';\r\n\tstatic readonly DAYS_IN_ONE_YEAR       = 365;\r\n\tstatic readonly DAYS_IN_WEEK           = 7;\r\n\tstatic readonly SQUARE_SIZE            = 10;\r\n\r\n\tstartDate: Date;\r\n\tendDate: Date;\r\n\tmax: number;\r\n\r\n\tprivate _values: Value[];\r\n\tprivate _firstFullWeekOfMonths?: Month[];\r\n\tprivate _activities?: Activities;\r\n\tprivate _calendar?: Calendar;\r\n\r\n\tconstructor(endDate: Date | string, values: Value[], max?: number) {\r\n\t\tthis.endDate   = this.parseDate(endDate);\r\n\t\tthis.max       = max || Math.ceil((Math.max(...values.map(day => day.count)) / 5) * 4);\r\n\t\tthis.startDate = this.shiftDate(endDate, -Heatmap.DAYS_IN_ONE_YEAR);\r\n\t\tthis._values   = values;\r\n\t}\r\n\r\n\tset values(v: Value[]) {\r\n\t\tthis.max                    = Math.ceil((Math.max(...v.map(day => day.count)) / 5) * 4);\r\n\t\tthis._values                = v;\r\n\t\tthis._firstFullWeekOfMonths = undefined;\r\n\t\tthis._calendar              = undefined;\r\n\t\tthis._activities            = undefined;\r\n\t}\r\n\r\n\tget values(): Value[] {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\tget activities(): Activities {\r\n\t\tif (!this._activities) {\r\n\t\t\tthis._activities = new Map();\r\n\t\t\tfor (let i = 0, len = this.values.length; i < len; i++) {\r\n\t\t\t\tthis._activities.set(this.keyDayParser(this.values[ i ].date), {\r\n\t\t\t\t\tcount     : this.values[ i ].count,\r\n\t\t\t\t\tcolorIndex: this.getColorIndex(this.values[ i ].count)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._activities;\r\n\t}\r\n\r\n\tget weekCount() {\r\n\t\treturn this.getDaysCount() / Heatmap.DAYS_IN_WEEK;\r\n\t}\r\n\r\n\tget calendar() {\r\n\t\tif (!this._calendar) {\r\n\t\t\tlet date       = this.shiftDate(this.startDate, -this.getCountEmptyDaysAtStart());\r\n\t\t\tdate           = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\t\t\tthis._calendar = new Array(this.weekCount);\r\n\t\t\tfor (let i = 0, len = this._calendar.length; i < len; i++) {\r\n\t\t\t\tthis._calendar[ i ] = new Array(Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tfor (let j = 0; j < Heatmap.DAYS_IN_WEEK; j++) {\r\n\t\t\t\t\tconst dayValues          = this.activities.get(this.keyDayParser(date));\r\n\t\t\t\t\tthis._calendar![ i ][ j ] = {\r\n\t\t\t\t\t\tdate      : new Date(date.valueOf()),\r\n\t\t\t\t\t\tcount     : dayValues ? dayValues.count : undefined,\r\n\t\t\t\t\t\tcolorIndex: dayValues ? dayValues.colorIndex : 0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tdate.setDate(date.getDate() + 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._calendar;\r\n\t}\r\n\r\n\tget firstFullWeekOfMonths(): Month[] {\r\n\t\tif (!this._firstFullWeekOfMonths) {\r\n\t\t\tconst cal                   = this.calendar;\r\n\t\t\tthis._firstFullWeekOfMonths = [];\r\n\t\t\tfor (let index = 1, len = cal.length; index < len; index++) {\r\n\t\t\t\tconst lastWeek    = cal[ index - 1 ][ 0 ].date,\r\n\t\t\t\t\t  currentWeek = cal[ index ][ 0 ].date;\r\n\t\t\t\tif (lastWeek.getFullYear() < currentWeek.getFullYear() || lastWeek.getMonth() < currentWeek.getMonth()) {\r\n\t\t\t\t\tthis._firstFullWeekOfMonths.push({ value: currentWeek.getMonth(), index });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._firstFullWeekOfMonths;\r\n\t}\r\n\r\n\tgetColorIndex(count?: number) {\r\n\t\tif (count === null || count === undefined) {\r\n\t\t\treturn 0;\r\n\t\t} else if (count <= 0) {\r\n\t\t\treturn 1;\r\n\t\t} else if (count >= this.max) {\r\n\t\t\treturn 5;\r\n\t\t} else {\r\n\t\t\treturn (Math.ceil(((count * 100) / this.max) * (0.03))) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\tgetCountEmptyDaysAtStart() {\r\n\t\treturn this.startDate.getDay();\r\n\t}\r\n\r\n\tgetCountEmptyDaysAtEnd() {\r\n\t\treturn (Heatmap.DAYS_IN_WEEK - 1) - this.endDate.getDay();\r\n\t}\r\n\r\n\tgetDaysCount() {\r\n\t\treturn Heatmap.DAYS_IN_ONE_YEAR + 1 + this.getCountEmptyDaysAtStart() + this.getCountEmptyDaysAtEnd();\r\n\t}\r\n\r\n\tprivate shiftDate(date: Date | string, numDays: number) {\r\n\t\tconst newDate = new Date(date);\r\n\t\tnewDate.setDate(newDate.getDate() + numDays);\r\n\t\treturn newDate;\r\n\t}\r\n\r\n\tprivate parseDate(entry: Date | string) {\r\n\t\treturn (entry instanceof Date) ? entry : (new Date(entry));\r\n\t}\r\n\r\n\tprivate keyDayParser(date: Date | string) {\r\n\t\tconst day = this.parseDate(date);\r\n\t\treturn String(day.getFullYear()) + String(day.getMonth()).padStart(2, '0') + String(day.getDate()).padStart(2, '0');\r\n\t}\r\n\r\n}\r\n","<template>\r\n\t<div class=\"vch__container\">\r\n\t\t<div class=\"vch__scroll-area\">\r\n\t\t\t<svg class=\"vch__wrapper\" :viewBox=\"viewbox\">\r\n\t\t\t\t<!-- Месяцы -->\r\n\t\t\t\t<g class=\"vch__months__labels__wrapper\" :transform=\"monthsLabelWrapperTransform\">\r\n\t\t\t\t\t<text class=\"vch__month__label\" v-for=\"(month, index) in heatmap.firstFullWeekOfMonths\" :key=\"index\"\r\n\t\t\t\t\t\t:x=\"getMonthLabelPosition(month).x\" :y=\"getMonthLabelPosition(month).y\">\r\n\t\t\t\t\t\t{{ lo.months[month.value] }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Дни недели -->\r\n\t\t\t\t<g class=\"vch__days__labels__wrapper\" :transform=\"daysLabelWrapperTransform\">\r\n\t\t\t\t\t<text v-for=\"(day, idx) in lo.days\" :key=\"idx\" class=\"vch__day__label\" :x=\"0\"\r\n\t\t\t\t\t\t:y=\"idx * SQUARE_SIZE + SQUARE_SIZE / 1.5\">\r\n\t\t\t\t\t\t{{ day }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Календарь -->\r\n\t\t\t\t<g class=\"vch__year__wrapper\" :transform=\"yearWrapperTransform\" @mouseover=\"initTippyLazy\">\r\n\t\t\t\t\t<g class=\"vch__month__wrapper\" v-for=\"(week, weekIndex) in heatmap.calendar\" :key=\"weekIndex\"\r\n\t\t\t\t\t\t:transform=\"getWeekPosition(weekIndex)\">\r\n\t\t\t\t\t\t<template v-for=\"(day, dayIndex) in week\" :key=\"dayIndex\">\r\n\t\t\t\t\t\t\t<rect class=\"vch__day__square\" v-if=\"day.date < now\" :rx=\"round\" :ry=\"round\"\r\n\t\t\t\t\t\t\t\t:transform=\"getDayPosition(dayIndex)\" :width=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\"\r\n\t\t\t\t\t\t\t\t:height=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\" :style=\"{ fill: curRangeColor[day.colorIndex] }\"\r\n\t\t\t\t\t\t\t\t:data-week-index=\"weekIndex\" :data-day-index=\"dayIndex\" @click=\"$emit('dayClick', day)\" />\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</g>\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t\t<div class=\"vch__legend-modern\">\r\n\t\t\t<span>{{ lo.less }}</span>\r\n\t\t\t<div class=\"vch__legend-modern-bar\">\r\n\t\t\t\t<span v-for=\"(color, idx) in curRangeColor\" :key=\"idx\" class=\"vch__legend-modern-box\"\r\n\t\t\t\t\t:style=\"{ background: color }\" />\r\n\t\t\t</div>\r\n\t\t\t<span>{{ lo.more }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, nextTick, onBeforeUnmount, onMounted, PropType, ref, toRef, toRefs, watch } from 'vue';\r\nimport { CalendarItem, Heatmap, Locale, Month, TooltipFormatter, Value } from '@/components/Heatmap';\r\nimport tippy, { createSingleton, CreateSingletonInstance, Instance } from 'tippy.js';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport 'tippy.js/dist/svg-arrow.css';\r\n\r\nexport default /*#__PURE__*/defineComponent({\r\n\tname: 'CalendarHeatmap',\r\n\tprops: {\r\n\t\tendDate: { required: true },\r\n\t\tmax: { type: Number },\r\n\t\trangeColor: { type: Array as PropType<string[]> },\r\n\t\tvalues: { type: Array as PropType<Value[]>, required: true },\r\n\t\tlocale: { type: Object as PropType<Partial<Locale>> },\r\n\t\ttooltip: { type: Boolean, default: true },\r\n\t\ttooltipUnit: { type: String, default: Heatmap.DEFAULT_TOOLTIP_UNIT },\r\n\t\ttooltipFormatter: { type: Function as PropType<TooltipFormatter> },\r\n\t\tvertical: { type: Boolean, default: false },\r\n\t\tnoDataText: { type: [Boolean, String], default: null },\r\n\t\tround: { type: Number, default: 0 },\r\n\t\tdarkMode: Boolean\r\n\t},\r\n\temits: ['dayClick'],\r\n\tsetup(props) {\r\n\t\tconst SQUARE_BORDER_SIZE = Heatmap.SQUARE_SIZE / 5,\r\n\t\t\tSQUARE_SIZE = Heatmap.SQUARE_SIZE + SQUARE_BORDER_SIZE,\r\n\t\t\tLEFT_SECTION_WIDTH = Math.ceil(Heatmap.SQUARE_SIZE * 2.5),\r\n\t\t\tRIGHT_SECTION_WIDTH = SQUARE_SIZE * 3,\r\n\t\t\tTOP_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tBOTTOM_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tyearWrapperTransform = `translate(${LEFT_SECTION_WIDTH}, ${TOP_SECTION_HEIGHT})`,\r\n\t\t\tsvg = ref<null | SVGElement>(null),\r\n\t\t\tnow = ref(new Date()),\r\n\t\t\theatmap = ref(new Heatmap(props.endDate as Date, props.values, props.max)),\r\n\t\t\twidth = ref(0),\r\n\t\t\theight = ref(0),\r\n\t\t\tviewbox = ref('0 0 0 0'),\r\n\t\t\tlegendViewbox = ref('0 0 0 0'),\r\n\t\t\tdaysLabelWrapperTransform = ref(''),\r\n\t\t\tmonthsLabelWrapperTransform = ref(''),\r\n\t\t\tlegendWrapperTransform = ref(''),\r\n\t\t\tlo = ref<Locale>({} as any),\r\n\t\t\trangeColor = ref<string[]>(props.rangeColor || (props.darkMode ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT));\r\n\r\n\t\tconst { values, tooltipUnit, tooltipFormatter, noDataText, max, vertical, locale } = toRefs(props),\r\n\t\t\ttippyInstances = new Map<HTMLElement, Instance>();\r\n\r\n\t\tlet tippySingleton: CreateSingletonInstance;\r\n\r\n\t\tfunction initTippy() {\r\n\t\t\ttippyInstances.clear();\r\n\t\t\tif (tippySingleton) {\r\n\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t} else {\r\n\t\t\t\ttippySingleton = createSingleton(Array.from(tippyInstances.values()), {\r\n\t\t\t\t\toverrides: [],\r\n\t\t\t\t\tmoveTransition: 'transform 0.1s ease-out',\r\n\t\t\t\t\tallowHTML: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction tooltipOptions(day: CalendarItem) {\r\n\t\t\tif (props.tooltip) {\r\n\t\t\t\tif (day.count !== undefined) {\r\n\t\t\t\t\tif (props.tooltipFormatter) {\r\n\t\t\t\t\t\treturn props.tooltipFormatter(day, props.tooltipUnit!);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn `<b>${day.count} ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t} else if (props.noDataText) {\r\n\t\t\t\t\treturn `${props.noDataText}`;\r\n\t\t\t\t} else if (props.noDataText !== false) {\r\n\t\t\t\t\treturn `<b>No ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tfunction getWeekPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(0, ${(SQUARE_SIZE * heatmap.value.weekCount) - ((index + 1) * SQUARE_SIZE)})`;\r\n\t\t\t}\r\n\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t}\r\n\r\n\t\tfunction getDayPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t\t}\r\n\t\t\treturn `translate(0, ${index * SQUARE_SIZE})`;\r\n\t\t}\r\n\r\n\t\tfunction getMonthLabelPosition(month: Month) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn { x: 3, y: (SQUARE_SIZE * heatmap.value.weekCount) - (SQUARE_SIZE * (month.index)) - (SQUARE_SIZE / 4) };\r\n\t\t\t}\r\n\t\t\treturn { x: SQUARE_SIZE * month.index * 0.96, y: SQUARE_SIZE - SQUARE_BORDER_SIZE };\r\n\t\t}\r\n\r\n\t\twatch([toRef(props, 'rangeColor'), toRef(props, 'darkMode')], ([rc, dm]) => {\r\n\t\t\trangeColor.value = rc || (dm ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT);\r\n\t\t});\r\n\r\n\t\twatch(vertical, v => {\r\n\t\t\tif (v) {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK) + RIGHT_SECTION_WIDTH;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t} else {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t}\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch([width, height], ([w, h]) => (viewbox.value = ` 0 0 ${w} ${h}`), { immediate: true });\r\n\t\twatch([width, height, rangeColor], ([w, h, rc]) => {\r\n\t\t\tlegendWrapperTransform.value = vertical.value\r\n\t\t\t\t? `translate(${LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK)}, ${TOP_SECTION_HEIGHT})`\r\n\t\t\t\t: `translate(${w - (SQUARE_SIZE * rc.length) - 30}, ${h - BOTTOM_SECTION_HEIGHT})`;\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch(locale, l => (lo.value = l ? { ...Heatmap.DEFAULT_LOCALE, ...l } : Heatmap.DEFAULT_LOCALE), { immediate: true });\r\n\t\twatch(rangeColor, rc => (legendViewbox.value = `0 0 ${Heatmap.SQUARE_SIZE * (rc.length + 1)} ${Heatmap.SQUARE_SIZE}`), { immediate: true });\r\n\r\n\t\twatch(\r\n\t\t\t[values, tooltipUnit, tooltipFormatter, noDataText, max, rangeColor],\r\n\t\t\t() => {\r\n\t\t\t\theatmap.value = new Heatmap(props.endDate as Date, props.values, props.max);\r\n\t\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t\t\tnextTick(initTippy);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tonMounted(initTippy);\r\n\t\tonBeforeUnmount(() => {\r\n\t\t\ttippySingleton?.destroy();\r\n\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t});\r\n\r\n\t\tfunction initTippyLazy(e: MouseEvent) {\r\n\t\t\tif (tippySingleton\r\n\t\t\t\t&& e.target\r\n\t\t\t\t&& (e.target as HTMLElement).classList.contains('vch__day__square')\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.weekIndex !== undefined\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.dayIndex !== undefined\r\n\t\t\t) {\r\n\t\t\t\tconst weekIndex = Number((e.target as HTMLElement).dataset.weekIndex),\r\n\t\t\t\t\tdayIndex = Number((e.target as HTMLElement).dataset.dayIndex);\r\n\r\n\t\t\t\tif (!isNaN(weekIndex) && !isNaN(dayIndex)) {\r\n\t\t\t\t\tconst tooltip = tooltipOptions(heatmap.value.calendar[weekIndex][dayIndex]);\r\n\t\t\t\t\tif (tooltip) {\r\n\t\t\t\t\t\tconst instance = tippyInstances.get(e.target as HTMLElement);\r\n\t\t\t\t\t\tif (instance) {\r\n\t\t\t\t\t\t\tinstance.setContent(tooltip);\r\n\t\t\t\t\t\t} else if (!instance) {\r\n\t\t\t\t\t\t\ttippyInstances.set(e.target as HTMLElement, tippy(e.target as HTMLElement, { content: tooltip } as any));\r\n\t\t\t\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tSQUARE_BORDER_SIZE, SQUARE_SIZE, LEFT_SECTION_WIDTH, RIGHT_SECTION_WIDTH, TOP_SECTION_HEIGHT, BOTTOM_SECTION_HEIGHT,\r\n\t\t\tsvg, heatmap, now, width, height, viewbox, daysLabelWrapperTransform, monthsLabelWrapperTransform, yearWrapperTransform, legendWrapperTransform,\r\n\t\t\tlo, legendViewbox, curRangeColor: rangeColor,\r\n\t\t\tgetWeekPosition, getDayPosition, getMonthLabelPosition, initTippyLazy, round: props.round\r\n\t\t};\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.vch__container {\r\n\twidth: 100%;\r\n\tmax-width: 800px;\r\n\tmargin: 40px auto 0 auto;\r\n\tbackground: #fff;\r\n\tborder-radius: 18px;\r\n\tbox-shadow: 0 3px 18px #0001;\r\n\tpadding: 16px 5px 0 5px;\r\n\tbox-sizing: border-box;\r\n}\r\n\r\n.vch__scroll-area {\r\n\toverflow-x: auto;\r\n\t-webkit-overflow-scrolling: touch;\r\n\tscrollbar-width: thin;\r\n}\r\n\r\nsvg.vch__wrapper {\r\n\twidth: 700px;\r\n\tmin-width: 700px;\r\n\tmax-width: 700px;\r\n\tdisplay: block;\r\n\theight: auto;\r\n}\r\n\r\n/* Легенда — в одну строку, всегда под SVG, не в скролле! */\r\n.vch__legend-modern {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tgap: 10px;\r\n\tmargin-top: 10px;\r\n\tmargin-bottom: 0;\r\n\tfont-size: 1em;\r\n\tcolor: #322850;\r\n\tflex-wrap: nowrap;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n.vch__legend-modern-bar {\r\n\tdisplay: flex;\r\n\tgap: 3px;\r\n}\r\n\r\n.vch__legend-modern-box {\r\n\twidth: 18px;\r\n\theight: 12px;\r\n\tborder-radius: 3px;\r\n\tborder: 1px solid #dedede;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n@media (max-width: 800px) {\r\n\t.vch__container {\r\n\t\tmax-width: 100vw;\r\n\t\twidth: 100vw;\r\n\t\tborder-radius: 0;\r\n\t\tpadding: 6px 1px 0 1px;\r\n\t}\r\n\r\n\tsvg.vch__wrapper {\r\n\t\twidth: 700px;\r\n\t\tmin-width: 700px;\r\n\t\tmax-width: 700px;\r\n\t}\r\n}\r\n\r\n@media (max-width: 420px) {\r\n\t.vch__legend-modern {\r\n\t\tfont-size: 0.7em;\r\n\t\tgap: 3px;\r\n\t}\r\n\r\n\t.vch__legend-modern-box {\r\n\t\twidth: 10px;\r\n\t\theight: 7px;\r\n\t}\r\n}\r\n</style>\r\n","<template>\r\n\t<div class=\"vch__container\">\r\n\t\t<div class=\"vch__scroll-area\">\r\n\t\t\t<svg class=\"vch__wrapper\" :viewBox=\"viewbox\">\r\n\t\t\t\t<!-- Месяцы -->\r\n\t\t\t\t<g class=\"vch__months__labels__wrapper\" :transform=\"monthsLabelWrapperTransform\">\r\n\t\t\t\t\t<text class=\"vch__month__label\" v-for=\"(month, index) in heatmap.firstFullWeekOfMonths\" :key=\"index\"\r\n\t\t\t\t\t\t:x=\"getMonthLabelPosition(month).x\" :y=\"getMonthLabelPosition(month).y\">\r\n\t\t\t\t\t\t{{ lo.months[month.value] }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Дни недели -->\r\n\t\t\t\t<g class=\"vch__days__labels__wrapper\" :transform=\"daysLabelWrapperTransform\">\r\n\t\t\t\t\t<text v-for=\"(day, idx) in lo.days\" :key=\"idx\" class=\"vch__day__label\" :x=\"0\"\r\n\t\t\t\t\t\t:y=\"idx * SQUARE_SIZE + SQUARE_SIZE / 1.5\">\r\n\t\t\t\t\t\t{{ day }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Календарь -->\r\n\t\t\t\t<g class=\"vch__year__wrapper\" :transform=\"yearWrapperTransform\" @mouseover=\"initTippyLazy\">\r\n\t\t\t\t\t<g class=\"vch__month__wrapper\" v-for=\"(week, weekIndex) in heatmap.calendar\" :key=\"weekIndex\"\r\n\t\t\t\t\t\t:transform=\"getWeekPosition(weekIndex)\">\r\n\t\t\t\t\t\t<template v-for=\"(day, dayIndex) in week\" :key=\"dayIndex\">\r\n\t\t\t\t\t\t\t<rect class=\"vch__day__square\" v-if=\"day.date < now\" :rx=\"round\" :ry=\"round\"\r\n\t\t\t\t\t\t\t\t:transform=\"getDayPosition(dayIndex)\" :width=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\"\r\n\t\t\t\t\t\t\t\t:height=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\" :style=\"{ fill: curRangeColor[day.colorIndex] }\"\r\n\t\t\t\t\t\t\t\t:data-week-index=\"weekIndex\" :data-day-index=\"dayIndex\" @click=\"$emit('dayClick', day)\" />\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</g>\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t\t<div class=\"vch__legend-modern\">\r\n\t\t\t<span>{{ lo.less }}</span>\r\n\t\t\t<div class=\"vch__legend-modern-bar\">\r\n\t\t\t\t<span v-for=\"(color, idx) in curRangeColor\" :key=\"idx\" class=\"vch__legend-modern-box\"\r\n\t\t\t\t\t:style=\"{ background: color }\" />\r\n\t\t\t</div>\r\n\t\t\t<span>{{ lo.more }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, nextTick, onBeforeUnmount, onMounted, PropType, ref, toRef, toRefs, watch } from 'vue';\r\nimport { CalendarItem, Heatmap, Locale, Month, TooltipFormatter, Value } from '@/components/Heatmap';\r\nimport tippy, { createSingleton, CreateSingletonInstance, Instance } from 'tippy.js';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport 'tippy.js/dist/svg-arrow.css';\r\n\r\nexport default /*#__PURE__*/defineComponent({\r\n\tname: 'CalendarHeatmap',\r\n\tprops: {\r\n\t\tendDate: { required: true },\r\n\t\tmax: { type: Number },\r\n\t\trangeColor: { type: Array as PropType<string[]> },\r\n\t\tvalues: { type: Array as PropType<Value[]>, required: true },\r\n\t\tlocale: { type: Object as PropType<Partial<Locale>> },\r\n\t\ttooltip: { type: Boolean, default: true },\r\n\t\ttooltipUnit: { type: String, default: Heatmap.DEFAULT_TOOLTIP_UNIT },\r\n\t\ttooltipFormatter: { type: Function as PropType<TooltipFormatter> },\r\n\t\tvertical: { type: Boolean, default: false },\r\n\t\tnoDataText: { type: [Boolean, String], default: null },\r\n\t\tround: { type: Number, default: 0 },\r\n\t\tdarkMode: Boolean\r\n\t},\r\n\temits: ['dayClick'],\r\n\tsetup(props) {\r\n\t\tconst SQUARE_BORDER_SIZE = Heatmap.SQUARE_SIZE / 5,\r\n\t\t\tSQUARE_SIZE = Heatmap.SQUARE_SIZE + SQUARE_BORDER_SIZE,\r\n\t\t\tLEFT_SECTION_WIDTH = Math.ceil(Heatmap.SQUARE_SIZE * 2.5),\r\n\t\t\tRIGHT_SECTION_WIDTH = SQUARE_SIZE * 3,\r\n\t\t\tTOP_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tBOTTOM_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tyearWrapperTransform = `translate(${LEFT_SECTION_WIDTH}, ${TOP_SECTION_HEIGHT})`,\r\n\t\t\tsvg = ref<null | SVGElement>(null),\r\n\t\t\tnow = ref(new Date()),\r\n\t\t\theatmap = ref(new Heatmap(props.endDate as Date, props.values, props.max)),\r\n\t\t\twidth = ref(0),\r\n\t\t\theight = ref(0),\r\n\t\t\tviewbox = ref('0 0 0 0'),\r\n\t\t\tlegendViewbox = ref('0 0 0 0'),\r\n\t\t\tdaysLabelWrapperTransform = ref(''),\r\n\t\t\tmonthsLabelWrapperTransform = ref(''),\r\n\t\t\tlegendWrapperTransform = ref(''),\r\n\t\t\tlo = ref<Locale>({} as any),\r\n\t\t\trangeColor = ref<string[]>(props.rangeColor || (props.darkMode ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT));\r\n\r\n\t\tconst { values, tooltipUnit, tooltipFormatter, noDataText, max, vertical, locale } = toRefs(props),\r\n\t\t\ttippyInstances = new Map<HTMLElement, Instance>();\r\n\r\n\t\tlet tippySingleton: CreateSingletonInstance;\r\n\r\n\t\tfunction initTippy() {\r\n\t\t\ttippyInstances.clear();\r\n\t\t\tif (tippySingleton) {\r\n\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t} else {\r\n\t\t\t\ttippySingleton = createSingleton(Array.from(tippyInstances.values()), {\r\n\t\t\t\t\toverrides: [],\r\n\t\t\t\t\tmoveTransition: 'transform 0.1s ease-out',\r\n\t\t\t\t\tallowHTML: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction tooltipOptions(day: CalendarItem) {\r\n\t\t\tif (props.tooltip) {\r\n\t\t\t\tif (day.count !== undefined) {\r\n\t\t\t\t\tif (props.tooltipFormatter) {\r\n\t\t\t\t\t\treturn props.tooltipFormatter(day, props.tooltipUnit!);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn `<b>${day.count} ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t} else if (props.noDataText) {\r\n\t\t\t\t\treturn `${props.noDataText}`;\r\n\t\t\t\t} else if (props.noDataText !== false) {\r\n\t\t\t\t\treturn `<b>No ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tfunction getWeekPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(0, ${(SQUARE_SIZE * heatmap.value.weekCount) - ((index + 1) * SQUARE_SIZE)})`;\r\n\t\t\t}\r\n\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t}\r\n\r\n\t\tfunction getDayPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t\t}\r\n\t\t\treturn `translate(0, ${index * SQUARE_SIZE})`;\r\n\t\t}\r\n\r\n\t\tfunction getMonthLabelPosition(month: Month) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn { x: 3, y: (SQUARE_SIZE * heatmap.value.weekCount) - (SQUARE_SIZE * (month.index)) - (SQUARE_SIZE / 4) };\r\n\t\t\t}\r\n\t\t\treturn { x: SQUARE_SIZE * month.index * 0.96, y: SQUARE_SIZE - SQUARE_BORDER_SIZE };\r\n\t\t}\r\n\r\n\t\twatch([toRef(props, 'rangeColor'), toRef(props, 'darkMode')], ([rc, dm]) => {\r\n\t\t\trangeColor.value = rc || (dm ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT);\r\n\t\t});\r\n\r\n\t\twatch(vertical, v => {\r\n\t\t\tif (v) {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK) + RIGHT_SECTION_WIDTH;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t} else {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t}\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch([width, height], ([w, h]) => (viewbox.value = ` 0 0 ${w} ${h}`), { immediate: true });\r\n\t\twatch([width, height, rangeColor], ([w, h, rc]) => {\r\n\t\t\tlegendWrapperTransform.value = vertical.value\r\n\t\t\t\t? `translate(${LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK)}, ${TOP_SECTION_HEIGHT})`\r\n\t\t\t\t: `translate(${w - (SQUARE_SIZE * rc.length) - 30}, ${h - BOTTOM_SECTION_HEIGHT})`;\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch(locale, l => (lo.value = l ? { ...Heatmap.DEFAULT_LOCALE, ...l } : Heatmap.DEFAULT_LOCALE), { immediate: true });\r\n\t\twatch(rangeColor, rc => (legendViewbox.value = `0 0 ${Heatmap.SQUARE_SIZE * (rc.length + 1)} ${Heatmap.SQUARE_SIZE}`), { immediate: true });\r\n\r\n\t\twatch(\r\n\t\t\t[values, tooltipUnit, tooltipFormatter, noDataText, max, rangeColor],\r\n\t\t\t() => {\r\n\t\t\t\theatmap.value = new Heatmap(props.endDate as Date, props.values, props.max);\r\n\t\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t\t\tnextTick(initTippy);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tonMounted(initTippy);\r\n\t\tonBeforeUnmount(() => {\r\n\t\t\ttippySingleton?.destroy();\r\n\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t});\r\n\r\n\t\tfunction initTippyLazy(e: MouseEvent) {\r\n\t\t\tif (tippySingleton\r\n\t\t\t\t&& e.target\r\n\t\t\t\t&& (e.target as HTMLElement).classList.contains('vch__day__square')\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.weekIndex !== undefined\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.dayIndex !== undefined\r\n\t\t\t) {\r\n\t\t\t\tconst weekIndex = Number((e.target as HTMLElement).dataset.weekIndex),\r\n\t\t\t\t\tdayIndex = Number((e.target as HTMLElement).dataset.dayIndex);\r\n\r\n\t\t\t\tif (!isNaN(weekIndex) && !isNaN(dayIndex)) {\r\n\t\t\t\t\tconst tooltip = tooltipOptions(heatmap.value.calendar[weekIndex][dayIndex]);\r\n\t\t\t\t\tif (tooltip) {\r\n\t\t\t\t\t\tconst instance = tippyInstances.get(e.target as HTMLElement);\r\n\t\t\t\t\t\tif (instance) {\r\n\t\t\t\t\t\t\tinstance.setContent(tooltip);\r\n\t\t\t\t\t\t} else if (!instance) {\r\n\t\t\t\t\t\t\ttippyInstances.set(e.target as HTMLElement, tippy(e.target as HTMLElement, { content: tooltip } as any));\r\n\t\t\t\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tSQUARE_BORDER_SIZE, SQUARE_SIZE, LEFT_SECTION_WIDTH, RIGHT_SECTION_WIDTH, TOP_SECTION_HEIGHT, BOTTOM_SECTION_HEIGHT,\r\n\t\t\tsvg, heatmap, now, width, height, viewbox, daysLabelWrapperTransform, monthsLabelWrapperTransform, yearWrapperTransform, legendWrapperTransform,\r\n\t\t\tlo, legendViewbox, curRangeColor: rangeColor,\r\n\t\t\tgetWeekPosition, getDayPosition, getMonthLabelPosition, initTippyLazy, round: props.round\r\n\t\t};\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.vch__container {\r\n\twidth: 100%;\r\n\tmax-width: 800px;\r\n\tmargin: 40px auto 0 auto;\r\n\tbackground: #fff;\r\n\tborder-radius: 18px;\r\n\tbox-shadow: 0 3px 18px #0001;\r\n\tpadding: 16px 5px 0 5px;\r\n\tbox-sizing: border-box;\r\n}\r\n\r\n.vch__scroll-area {\r\n\toverflow-x: auto;\r\n\t-webkit-overflow-scrolling: touch;\r\n\tscrollbar-width: thin;\r\n}\r\n\r\nsvg.vch__wrapper {\r\n\twidth: 700px;\r\n\tmin-width: 700px;\r\n\tmax-width: 700px;\r\n\tdisplay: block;\r\n\theight: auto;\r\n}\r\n\r\n/* Легенда — в одну строку, всегда под SVG, не в скролле! */\r\n.vch__legend-modern {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tgap: 10px;\r\n\tmargin-top: 10px;\r\n\tmargin-bottom: 0;\r\n\tfont-size: 1em;\r\n\tcolor: #322850;\r\n\tflex-wrap: nowrap;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n.vch__legend-modern-bar {\r\n\tdisplay: flex;\r\n\tgap: 3px;\r\n}\r\n\r\n.vch__legend-modern-box {\r\n\twidth: 18px;\r\n\theight: 12px;\r\n\tborder-radius: 3px;\r\n\tborder: 1px solid #dedede;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n@media (max-width: 800px) {\r\n\t.vch__container {\r\n\t\tmax-width: 100vw;\r\n\t\twidth: 100vw;\r\n\t\tborder-radius: 0;\r\n\t\tpadding: 6px 1px 0 1px;\r\n\t}\r\n\r\n\tsvg.vch__wrapper {\r\n\t\twidth: 700px;\r\n\t\tmin-width: 700px;\r\n\t\tmax-width: 700px;\r\n\t}\r\n}\r\n\r\n@media (max-width: 420px) {\r\n\t.vch__legend-modern {\r\n\t\tfont-size: 0.7em;\r\n\t\tgap: 3px;\r\n\t}\r\n\r\n\t.vch__legend-modern-box {\r\n\t\twidth: 10px;\r\n\t\theight: 7px;\r\n\t}\r\n}\r\n</style>\r\n","import { App } from 'vue';\r\nimport CalendarHeatmap from '@/components/CalendarHeatmap.vue';\r\n\r\nfunction install(Vue: App) {\r\n\tVue.component(CalendarHeatmap.name!, CalendarHeatmap);\r\n}\r\n\r\nexport default { install };\r\nexport * from '@/components/Heatmap';\r\nexport { default as CalendarHeatmap } from '@/components/CalendarHeatmap.vue';\r\n"],"names":["_Heatmap","endDate","values","max","__publicField","day","v","i","len","date","j","dayValues","cal","index","lastWeek","currentWeek","count","numDays","newDate","entry","Heatmap","_sfc_main","defineComponent","props","SQUARE_BORDER_SIZE","SQUARE_SIZE","LEFT_SECTION_WIDTH","RIGHT_SECTION_WIDTH","TOP_SECTION_HEIGHT","BOTTOM_SECTION_HEIGHT","yearWrapperTransform","svg","ref","now","heatmap","width","height","viewbox","legendViewbox","daysLabelWrapperTransform","monthsLabelWrapperTransform","legendWrapperTransform","lo","rangeColor","tooltipUnit","tooltipFormatter","noDataText","vertical","locale","toRefs","tippyInstances","tippySingleton","initTippy","createSingleton","tooltipOptions","getWeekPosition","getDayPosition","getMonthLabelPosition","month","watch","toRef","rc","dm","w","h","l","item","nextTick","onMounted","onBeforeUnmount","initTippyLazy","e","weekIndex","dayIndex","tooltip","instance","tippy","_hoisted_9","_hoisted_10","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_openBlock","_Fragment","_renderList","_hoisted_4","idx","_hoisted_6","args","week","_hoisted_3","_hoisted_11","_toDisplayString","_hoisted_12","color","install","Vue","CalendarHeatmap"],"mappings":"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"}