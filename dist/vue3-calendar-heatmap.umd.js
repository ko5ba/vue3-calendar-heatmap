(function(i,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("tippy.js")):typeof define=="function"&&define.amd?define(["exports","vue","tippy.js"],e):(i=typeof globalThis<"u"?globalThis:i||self,e(i.CalendarHeatmap={},i.Vue,i.tippy))})(this,function(i,e,f){"use strict";var de=Object.defineProperty;var _e=(i,e,f)=>e in i?de(i,e,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[e]=f;var c=(i,e,f)=>(_e(i,typeof e!="symbol"?e+"":e,f),f);const u=class{constructor(a,n,l){c(this,"startDate");c(this,"endDate");c(this,"max");c(this,"_values");c(this,"_firstFullWeekOfMonths");c(this,"_activities");c(this,"_calendar");this.endDate=this.parseDate(a),this.max=l||Math.ceil(Math.max(...n.map(d=>d.count))/5*4),this.startDate=this.shiftDate(a,-u.DAYS_IN_ONE_YEAR),this._values=n}set values(a){this.max=Math.ceil(Math.max(...a.map(n=>n.count))/5*4),this._values=a,this._firstFullWeekOfMonths=void 0,this._calendar=void 0,this._activities=void 0}get values(){return this._values}get activities(){if(!this._activities){this._activities=new Map;for(let a=0,n=this.values.length;a<n;a++)this._activities.set(this.keyDayParser(this.values[a].date),{count:this.values[a].count,colorIndex:this.getColorIndex(this.values[a].count)})}return this._activities}get weekCount(){return this.getDaysCount()/u.DAYS_IN_WEEK}get calendar(){if(!this._calendar){let a=this.shiftDate(this.startDate,-this.getCountEmptyDaysAtStart());a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),this._calendar=new Array(this.weekCount);for(let n=0,l=this._calendar.length;n<l;n++){this._calendar[n]=new Array(u.DAYS_IN_WEEK);for(let d=0;d<u.DAYS_IN_WEEK;d++){const s=this.activities.get(this.keyDayParser(a));this._calendar[n][d]={date:new Date(a.valueOf()),count:s?s.count:void 0,colorIndex:s?s.colorIndex:0},a.setDate(a.getDate()+1)}}}return this._calendar}get firstFullWeekOfMonths(){if(!this._firstFullWeekOfMonths){const a=this.calendar;this._firstFullWeekOfMonths=[];for(let n=1,l=a.length;n<l;n++){const d=a[n-1][0].date,s=a[n][0].date;(d.getFullYear()<s.getFullYear()||d.getMonth()<s.getMonth())&&this._firstFullWeekOfMonths.push({value:s.getMonth(),index:n})}}return this._firstFullWeekOfMonths}getColorIndex(a){return a==null?0:a<=0?1:a>=this.max?5:Math.ceil(a*100/this.max*.03)+1}getCountEmptyDaysAtStart(){return this.startDate.getDay()}getCountEmptyDaysAtEnd(){return u.DAYS_IN_WEEK-1-this.endDate.getDay()}getDaysCount(){return u.DAYS_IN_ONE_YEAR+1+this.getCountEmptyDaysAtStart()+this.getCountEmptyDaysAtEnd()}shiftDate(a,n){const l=new Date(a);return l.setDate(l.getDate()+n),l}parseDate(a){return a instanceof Date?a:new Date(a)}keyDayParser(a){const n=this.parseDate(a);return String(n.getFullYear())+String(n.getMonth()).padStart(2,"0")+String(n.getDate()).padStart(2,"0")}};let o=u;c(o,"DEFAULT_RANGE_COLOR_LIGHT",["#ebedf0","#dae2ef","#c0ddf9","#73b3f3","#3886e1","#17459e"]),c(o,"DEFAULT_RANGE_COLOR_DARK",["#1f1f22","#1e334a","#1d466c","#1d5689","#1d69ac","#1B95D1"]),c(o,"DEFAULT_LOCALE",{months:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],days:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],less:"Низкая",more:"Высокая",on:"на"}),c(o,"DEFAULT_TOOLTIP_UNIT","contributions"),c(o,"DAYS_IN_ONE_YEAR",365),c(o,"DAYS_IN_WEEK",7),c(o,"SQUARE_SIZE",10);const he="",fe="",$=e.defineComponent({name:"CalendarHeatmap",props:{endDate:{required:!0},max:{type:Number},rangeColor:{type:Array},values:{type:Array,required:!0},locale:{type:Object},tooltip:{type:Boolean,default:!0},tooltipUnit:{type:String,default:o.DEFAULT_TOOLTIP_UNIT},tooltipFormatter:{type:Function},vertical:{type:Boolean,default:!1},noDataText:{type:[Boolean,String],default:null},round:{type:Number,default:0},darkMode:Boolean},emits:["dayClick"],setup(t){const a=o.SQUARE_SIZE/5,n=o.SQUARE_SIZE+a,l=Math.ceil(o.SQUARE_SIZE*2.5),d=n*3,s=o.SQUARE_SIZE+o.SQUARE_SIZE/2,_=o.SQUARE_SIZE+o.SQUARE_SIZE/2,h=`translate(${l}, ${s})`,p=e.ref(null),S=e.ref(new Date),E=e.ref(new o(t.endDate,t.values,t.max)),A=e.ref(0),k=e.ref(0),N=e.ref("0 0 0 0"),B=e.ref("0 0 0 0"),C=e.ref(""),L=e.ref(""),F=e.ref(""),D=e.ref({}),I=e.ref(t.rangeColor||(t.darkMode?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)),{values:X,tooltipUnit:ee,tooltipFormatter:te,noDataText:ae,max:ne,vertical:U,locale:re}=e.toRefs(t),m=new Map;let g;function M(){m.clear(),g?g.setInstances(Array.from(m.values())):g=f.createSingleton(Array.from(m.values()),{overrides:[],moveTransition:"transform 0.1s ease-out",allowHTML:!0})}function oe(r){if(t.tooltip){if(r.count!==void 0)return t.tooltipFormatter?t.tooltipFormatter(r,t.tooltipUnit):`<b>${r.count} ${t.tooltipUnit}</b> ${D.value.on} ${D.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`;if(t.noDataText)return`${t.noDataText}`;if(t.noDataText!==!1)return`<b>No ${t.tooltipUnit}</b> ${D.value.on} ${D.value.months[r.date.getMonth()]} ${r.date.getDate()}, ${r.date.getFullYear()}`}}function le(r){return t.vertical?`translate(0, ${n*E.value.weekCount-(r+1)*n})`:`translate(${r*n}, 0)`}function se(r){return t.vertical?`translate(${r*n}, 0)`:`translate(0, ${r*n})`}function ie(r){return t.vertical?{x:3,y:n*E.value.weekCount-n*r.index-n/4}:{x:n*r.index*.96,y:n-a}}e.watch([e.toRef(t,"rangeColor"),e.toRef(t,"darkMode")],([r,y])=>{I.value=r||(y?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)}),e.watch(U,r=>{r?(A.value=l+n*o.DAYS_IN_WEEK+d,k.value=s+n*E.value.weekCount+a,C.value=`translate(${l}, 0)`,L.value=`translate(0, ${s})`):(A.value=l+n*E.value.weekCount+a,k.value=s+n*o.DAYS_IN_WEEK,C.value=`translate(0, ${s})`,L.value=`translate(${l}, 0)`)},{immediate:!0}),e.watch([A,k],([r,y])=>N.value=` 0 0 ${r} ${y}`,{immediate:!0}),e.watch([A,k,I],([r,y,T])=>{F.value=U.value?`translate(${l+n*o.DAYS_IN_WEEK}, ${s})`:`translate(${r-n*T.length-30}, ${y-_})`},{immediate:!0}),e.watch(re,r=>D.value=r?{...o.DEFAULT_LOCALE,...r}:o.DEFAULT_LOCALE,{immediate:!0}),e.watch(I,r=>B.value=`0 0 ${o.SQUARE_SIZE*(r.length+1)} ${o.SQUARE_SIZE}`,{immediate:!0}),e.watch([X,ee,te,ae,ne,I],()=>{E.value=new o(t.endDate,t.values,t.max),m.forEach(r=>r.destroy()),e.nextTick(M)}),e.onMounted(M),e.onBeforeUnmount(()=>{g==null||g.destroy(),m.forEach(r=>r.destroy())});function ce(r){if(g&&r.target&&r.target.classList.contains("vch__day__square")&&r.target.dataset.weekIndex!==void 0&&r.target.dataset.dayIndex!==void 0){const y=Number(r.target.dataset.weekIndex),T=Number(r.target.dataset.dayIndex);if(!isNaN(y)&&!isNaN(T)){const w=oe(E.value.calendar[y][T]);if(w){const O=m.get(r.target);O?O.setContent(w):O||(m.set(r.target,f(r.target,{content:w})),g.setInstances(Array.from(m.values())))}}}}return{SQUARE_BORDER_SIZE:a,SQUARE_SIZE:n,LEFT_SECTION_WIDTH:l,RIGHT_SECTION_WIDTH:d,TOP_SECTION_HEIGHT:s,BOTTOM_SECTION_HEIGHT:_,svg:p,heatmap:E,now:S,width:A,height:k,viewbox:N,daysLabelWrapperTransform:C,monthsLabelWrapperTransform:L,yearWrapperTransform:h,legendWrapperTransform:F,lo:D,legendViewbox:B,curRangeColor:I,getWeekPosition:le,getDayPosition:se,getMonthLabelPosition:ie,initTippyLazy:ce,round:t.round}}}),ue="",b=(t,a)=>{const n=t.__vccOpts||t;for(const[l,d]of a)n[l]=d;return n},W={class:"vch__container"},v={class:"vch__scroll-area"},x=["viewBox"],Y=["transform"],Q=["x","y"],Z=["transform"],P=["y"],G=["transform"],V=["transform"],K=["rx","ry","transform","width","height","data-week-index","data-day-index","onClick"],H={class:"vch__legend-modern"},j={class:"vch__legend-modern-bar"};function q(t,a,n,l,d,s){return e.openBlock(),e.createElementBlock("div",W,[e.createElementVNode("div",v,[(e.openBlock(),e.createElementBlock("svg",{class:"vch__wrapper",viewBox:t.viewbox},[e.createElementVNode("g",{class:"vch__months__labels__wrapper",transform:t.monthsLabelWrapperTransform},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.firstFullWeekOfMonths,(_,h)=>(e.openBlock(),e.createElementBlock("text",{class:"vch__month__label",key:h,x:t.getMonthLabelPosition(_).x,y:t.getMonthLabelPosition(_).y},e.toDisplayString(t.lo.months[_.value]),9,Q))),128))],8,Y),e.createElementVNode("g",{class:"vch__days__labels__wrapper",transform:t.daysLabelWrapperTransform},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.lo.days,(_,h)=>(e.openBlock(),e.createElementBlock("text",{key:h,class:"vch__day__label",x:0,y:h*t.SQUARE_SIZE+t.SQUARE_SIZE/1.5},e.toDisplayString(_),9,P))),128))],8,Z),e.createElementVNode("g",{class:"vch__year__wrapper",transform:t.yearWrapperTransform,onMouseover:a[0]||(a[0]=(..._)=>t.initTippyLazy&&t.initTippyLazy(..._))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.calendar,(_,h)=>(e.openBlock(),e.createElementBlock("g",{class:"vch__month__wrapper",key:h,transform:t.getWeekPosition(h)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_,(p,S)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:S},[p.date<t.now?(e.openBlock(),e.createElementBlock("rect",{key:0,class:"vch__day__square",rx:t.round,ry:t.round,transform:t.getDayPosition(S),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,style:e.normalizeStyle({fill:t.curRangeColor[p.colorIndex]}),"data-week-index":h,"data-day-index":S,onClick:E=>t.$emit("dayClick",p)},null,12,K)):e.createCommentVNode("",!0)],64))),128))],8,V))),128))],40,G)],8,x))]),e.createElementVNode("div",H,[e.createElementVNode("span",null,e.toDisplayString(t.lo.less),1),e.createElementVNode("div",j,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(_,h)=>(e.openBlock(),e.createElementBlock("span",{key:h,class:"vch__legend-modern-box",style:e.normalizeStyle({background:_})},null,4))),128))]),e.createElementVNode("span",null,e.toDisplayString(t.lo.more),1)])])}const R=b($,[["render",q],["__scopeId","data-v-7dc98d8e"]]);function z(t){t.component(R.name,R)}const J={install:z};i.CalendarHeatmap=R,i.Heatmap=o,i.default=J,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue3-calendar-heatmap.umd.js.map
