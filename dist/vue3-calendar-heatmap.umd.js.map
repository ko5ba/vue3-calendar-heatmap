{"version":3,"file":"vue3-calendar-heatmap.umd.js","sources":["../src/components/Heatmap.ts","../src/components/CalendarHeatmap.vue","../src/components/CalendarHeatmap.vue","../src/index.ts"],"sourcesContent":["export interface Value {\r\n\tdate: Date | string;\r\n\tcount: number;\r\n}\r\n\r\nexport interface Activity {\r\n\tcount: number;\r\n\tcolorIndex: number;\r\n}\r\n\r\nexport type Activities = Map<string, Activity>;\r\n\r\nexport interface CalendarItem {\r\n\tdate: Date;\r\n\tcount?: number;\r\n\tcolorIndex: number;\r\n}\r\n\r\nexport type Calendar = CalendarItem[][];\r\n\r\nexport interface Month {\r\n\tvalue: number;\r\n\tindex: number;\r\n}\r\n\r\nexport interface Locale {\r\n\tmonths: string[];\r\n\tdays: string[];\r\n\ton: string;\r\n\tless: string;\r\n\tmore: string;\r\n}\r\n\r\nexport type TooltipFormatter = (item: CalendarItem, unit: string) => string;\r\n\r\nexport class Heatmap {\r\n\r\n\tstatic readonly DEFAULT_RANGE_COLOR_LIGHT = [ '#ebedf0', '#dae2ef', '#c0ddf9', '#73b3f3', '#3886e1', '#17459e' ];\r\n\tstatic readonly DEFAULT_RANGE_COLOR_DARK  = [ '#1f1f22', '#1e334a', '#1d466c', '#1d5689', '#1d69ac', '#1B95D1' ];\r\n\t// other color candidates\r\n\t// static readonly DEFAULT_RANGE_COLOR_LIGHT = [ '#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK  = [ '#161b22', '#0e4429', '#006d32', '#26a641', '#39d353' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#011526', '#012E40', '#025959', '#02735E', '#038C65' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#161b22', '#015958', '#008F8C', '#0CABA8', '#0FC2C0' ];\r\n\t// static readonly DEFAULT_RANGE_COLOR_DARK    = [ '#012030', '#13678A', '#45C4B0', '#9AEBA3', '#DAFDBA' ];\r\n\tstatic readonly DEFAULT_LOCALE: Locale = {\r\n\tmonths: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],\r\n\tdays: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],\r\n\tless: 'Низкая',\r\n\tmore: 'Высокая',\r\n\ton: 'на',\r\n};\r\n\tstatic readonly DEFAULT_TOOLTIP_UNIT   = 'contributions';\r\n\tstatic readonly DAYS_IN_ONE_YEAR       = 365;\r\n\tstatic readonly DAYS_IN_WEEK           = 7;\r\n\tstatic readonly SQUARE_SIZE            = 10;\r\n\r\n\tstartDate: Date;\r\n\tendDate: Date;\r\n\tmax: number;\r\n\r\n\tprivate _values: Value[];\r\n\tprivate _firstFullWeekOfMonths?: Month[];\r\n\tprivate _activities?: Activities;\r\n\tprivate _calendar?: Calendar;\r\n\r\n\tconstructor(endDate: Date | string, values: Value[], max?: number) {\r\n\t\tthis.endDate   = this.parseDate(endDate);\r\n\t\tthis.max       = max || Math.ceil((Math.max(...values.map(day => day.count)) / 5) * 4);\r\n\t\tthis.startDate = this.shiftDate(endDate, -Heatmap.DAYS_IN_ONE_YEAR);\r\n\t\tthis._values   = values;\r\n\t}\r\n\r\n\tset values(v: Value[]) {\r\n\t\tthis.max                    = Math.ceil((Math.max(...v.map(day => day.count)) / 5) * 4);\r\n\t\tthis._values                = v;\r\n\t\tthis._firstFullWeekOfMonths = undefined;\r\n\t\tthis._calendar              = undefined;\r\n\t\tthis._activities            = undefined;\r\n\t}\r\n\r\n\tget values(): Value[] {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\tget activities(): Activities {\r\n\t\tif (!this._activities) {\r\n\t\t\tthis._activities = new Map();\r\n\t\t\tfor (let i = 0, len = this.values.length; i < len; i++) {\r\n\t\t\t\tthis._activities.set(this.keyDayParser(this.values[ i ].date), {\r\n\t\t\t\t\tcount     : this.values[ i ].count,\r\n\t\t\t\t\tcolorIndex: this.getColorIndex(this.values[ i ].count)\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._activities;\r\n\t}\r\n\r\n\tget weekCount() {\r\n\t\treturn this.getDaysCount() / Heatmap.DAYS_IN_WEEK;\r\n\t}\r\n\r\n\tget calendar() {\r\n\t\tif (!this._calendar) {\r\n\t\t\tlet date       = this.shiftDate(this.startDate, -this.getCountEmptyDaysAtStart());\r\n\t\t\tdate           = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n\t\t\tthis._calendar = new Array(this.weekCount);\r\n\t\t\tfor (let i = 0, len = this._calendar.length; i < len; i++) {\r\n\t\t\t\tthis._calendar[ i ] = new Array(Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tfor (let j = 0; j < Heatmap.DAYS_IN_WEEK; j++) {\r\n\t\t\t\t\tconst dayValues          = this.activities.get(this.keyDayParser(date));\r\n\t\t\t\t\tthis._calendar![ i ][ j ] = {\r\n\t\t\t\t\t\tdate      : new Date(date.valueOf()),\r\n\t\t\t\t\t\tcount     : dayValues ? dayValues.count : undefined,\r\n\t\t\t\t\t\tcolorIndex: dayValues ? dayValues.colorIndex : 0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tdate.setDate(date.getDate() + 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._calendar;\r\n\t}\r\n\r\n\tget firstFullWeekOfMonths(): Month[] {\r\n\t\tif (!this._firstFullWeekOfMonths) {\r\n\t\t\tconst cal                   = this.calendar;\r\n\t\t\tthis._firstFullWeekOfMonths = [];\r\n\t\t\tfor (let index = 1, len = cal.length; index < len; index++) {\r\n\t\t\t\tconst lastWeek    = cal[ index - 1 ][ 0 ].date,\r\n\t\t\t\t\t  currentWeek = cal[ index ][ 0 ].date;\r\n\t\t\t\tif (lastWeek.getFullYear() < currentWeek.getFullYear() || lastWeek.getMonth() < currentWeek.getMonth()) {\r\n\t\t\t\t\tthis._firstFullWeekOfMonths.push({ value: currentWeek.getMonth(), index });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._firstFullWeekOfMonths;\r\n\t}\r\n\r\n\tgetColorIndex(count?: number) {\r\n\t\tif (count === null || count === undefined) {\r\n\t\t\treturn 0;\r\n\t\t} else if (count <= 0) {\r\n\t\t\treturn 1;\r\n\t\t} else if (count >= this.max) {\r\n\t\t\treturn 5;\r\n\t\t} else {\r\n\t\t\treturn (Math.ceil(((count * 100) / this.max) * (0.03))) + 1;\r\n\t\t}\r\n\t}\r\n\r\n\tgetCountEmptyDaysAtStart() {\r\n\t\treturn this.startDate.getDay();\r\n\t}\r\n\r\n\tgetCountEmptyDaysAtEnd() {\r\n\t\treturn (Heatmap.DAYS_IN_WEEK - 1) - this.endDate.getDay();\r\n\t}\r\n\r\n\tgetDaysCount() {\r\n\t\treturn Heatmap.DAYS_IN_ONE_YEAR + 1 + this.getCountEmptyDaysAtStart() + this.getCountEmptyDaysAtEnd();\r\n\t}\r\n\r\n\tprivate shiftDate(date: Date | string, numDays: number) {\r\n\t\tconst newDate = new Date(date);\r\n\t\tnewDate.setDate(newDate.getDate() + numDays);\r\n\t\treturn newDate;\r\n\t}\r\n\r\n\tprivate parseDate(entry: Date | string) {\r\n\t\treturn (entry instanceof Date) ? entry : (new Date(entry));\r\n\t}\r\n\r\n\tprivate keyDayParser(date: Date | string) {\r\n\t\tconst day = this.parseDate(date);\r\n\t\treturn String(day.getFullYear()) + String(day.getMonth()).padStart(2, '0') + String(day.getDate()).padStart(2, '0');\r\n\t}\r\n\r\n}\r\n","<template>\r\n\t<div class=\"vch__container\">\r\n\t\t<div class=\"vch__scroll-area\">\r\n\t\t\t<svg class=\"vch__wrapper\" :viewBox=\"viewbox\">\r\n\t\t\t\t<!-- Месяцы -->\r\n\t\t\t\t<g class=\"vch__months__labels__wrapper\" :transform=\"monthsLabelWrapperTransform\">\r\n\t\t\t\t\t<text class=\"vch__month__label\" v-for=\"(month, index) in heatmap.firstFullWeekOfMonths\" :key=\"index\"\r\n\t\t\t\t\t\t:x=\"getMonthLabelPosition(month).x\" :y=\"getMonthLabelPosition(month).y\">\r\n\t\t\t\t\t\t{{ lo.months[month.value] }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Дни недели -->\r\n\t\t\t\t<g class=\"vch__days__labels__wrapper\" :transform=\"daysLabelWrapperTransform\">\r\n\t\t\t\t\t<text v-for=\"(day, idx) in lo.days\" :key=\"idx\" class=\"vch__day__label\" :x=\"0\"\r\n\t\t\t\t\t\t:y=\"idx * SQUARE_SIZE + SQUARE_SIZE / 1.5\">\r\n\t\t\t\t\t\t{{ day }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Календарь -->\r\n\t\t\t\t<g class=\"vch__year__wrapper\" :transform=\"yearWrapperTransform\" @mouseover=\"initTippyLazy\">\r\n\t\t\t\t\t<g class=\"vch__month__wrapper\" v-for=\"(week, weekIndex) in heatmap.calendar\" :key=\"weekIndex\"\r\n\t\t\t\t\t\t:transform=\"getWeekPosition(weekIndex)\">\r\n\t\t\t\t\t\t<template v-for=\"(day, dayIndex) in week\" :key=\"dayIndex\">\r\n\t\t\t\t\t\t\t<rect class=\"vch__day__square\" v-if=\"day.date < now\" :rx=\"round\" :ry=\"round\"\r\n\t\t\t\t\t\t\t\t:transform=\"getDayPosition(dayIndex)\" :width=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\"\r\n\t\t\t\t\t\t\t\t:height=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\" :style=\"{ fill: curRangeColor[day.colorIndex] }\"\r\n\t\t\t\t\t\t\t\t:data-week-index=\"weekIndex\" :data-day-index=\"dayIndex\" @click=\"$emit('dayClick', day)\" />\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</g>\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t\t<div class=\"vch__legend-modern\">\r\n\t\t\t<span>{{ lo.less }}</span>\r\n\t\t\t<div class=\"vch__legend-modern-bar\">\r\n\t\t\t\t<span v-for=\"(color, idx) in curRangeColor\" :key=\"idx\" class=\"vch__legend-modern-box\"\r\n\t\t\t\t\t:style=\"{ background: color }\" />\r\n\t\t\t</div>\r\n\t\t\t<span>{{ lo.more }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, nextTick, onBeforeUnmount, onMounted, PropType, ref, toRef, toRefs, watch } from 'vue';\r\nimport { CalendarItem, Heatmap, Locale, Month, TooltipFormatter, Value } from '@/components/Heatmap';\r\nimport tippy, { createSingleton, CreateSingletonInstance, Instance } from 'tippy.js';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport 'tippy.js/dist/svg-arrow.css';\r\n\r\nexport default /*#__PURE__*/defineComponent({\r\n\tname: 'CalendarHeatmap',\r\n\tprops: {\r\n\t\tendDate: { required: true },\r\n\t\tmax: { type: Number },\r\n\t\trangeColor: { type: Array as PropType<string[]> },\r\n\t\tvalues: { type: Array as PropType<Value[]>, required: true },\r\n\t\tlocale: { type: Object as PropType<Partial<Locale>> },\r\n\t\ttooltip: { type: Boolean, default: true },\r\n\t\ttooltipUnit: { type: String, default: Heatmap.DEFAULT_TOOLTIP_UNIT },\r\n\t\ttooltipFormatter: { type: Function as PropType<TooltipFormatter> },\r\n\t\tvertical: { type: Boolean, default: false },\r\n\t\tnoDataText: { type: [Boolean, String], default: null },\r\n\t\tround: { type: Number, default: 0 },\r\n\t\tdarkMode: Boolean\r\n\t},\r\n\temits: ['dayClick'],\r\n\tsetup(props) {\r\n\t\tconst SQUARE_BORDER_SIZE = Heatmap.SQUARE_SIZE / 5,\r\n\t\t\tSQUARE_SIZE = Heatmap.SQUARE_SIZE + SQUARE_BORDER_SIZE,\r\n\t\t\tLEFT_SECTION_WIDTH = Math.ceil(Heatmap.SQUARE_SIZE * 2.5),\r\n\t\t\tRIGHT_SECTION_WIDTH = SQUARE_SIZE * 3,\r\n\t\t\tTOP_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tBOTTOM_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tyearWrapperTransform = `translate(${LEFT_SECTION_WIDTH}, ${TOP_SECTION_HEIGHT})`,\r\n\t\t\tsvg = ref<null | SVGElement>(null),\r\n\t\t\tnow = ref(new Date()),\r\n\t\t\theatmap = ref(new Heatmap(props.endDate as Date, props.values, props.max)),\r\n\t\t\twidth = ref(0),\r\n\t\t\theight = ref(0),\r\n\t\t\tviewbox = ref('0 0 0 0'),\r\n\t\t\tlegendViewbox = ref('0 0 0 0'),\r\n\t\t\tdaysLabelWrapperTransform = ref(''),\r\n\t\t\tmonthsLabelWrapperTransform = ref(''),\r\n\t\t\tlegendWrapperTransform = ref(''),\r\n\t\t\tlo = ref<Locale>({} as any),\r\n\t\t\trangeColor = ref<string[]>(props.rangeColor || (props.darkMode ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT));\r\n\r\n\t\tconst { values, tooltipUnit, tooltipFormatter, noDataText, max, vertical, locale } = toRefs(props),\r\n\t\t\ttippyInstances = new Map<HTMLElement, Instance>();\r\n\r\n\t\tlet tippySingleton: CreateSingletonInstance;\r\n\r\n\t\tfunction initTippy() {\r\n\t\t\ttippyInstances.clear();\r\n\t\t\tif (tippySingleton) {\r\n\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t} else {\r\n\t\t\t\ttippySingleton = createSingleton(Array.from(tippyInstances.values()), {\r\n\t\t\t\t\toverrides: [],\r\n\t\t\t\t\tmoveTransition: 'transform 0.1s ease-out',\r\n\t\t\t\t\tallowHTML: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction tooltipOptions(day: CalendarItem) {\r\n\t\t\tif (props.tooltip) {\r\n\t\t\t\tif (day.count !== undefined) {\r\n\t\t\t\t\tif (props.tooltipFormatter) {\r\n\t\t\t\t\t\treturn props.tooltipFormatter(day, props.tooltipUnit!);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn `<b>${day.count} ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t} else if (props.noDataText) {\r\n\t\t\t\t\treturn `${props.noDataText}`;\r\n\t\t\t\t} else if (props.noDataText !== false) {\r\n\t\t\t\t\treturn `<b>No ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tfunction getWeekPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(0, ${(SQUARE_SIZE * heatmap.value.weekCount) - ((index + 1) * SQUARE_SIZE)})`;\r\n\t\t\t}\r\n\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t}\r\n\r\n\t\tfunction getDayPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t\t}\r\n\t\t\treturn `translate(0, ${index * SQUARE_SIZE})`;\r\n\t\t}\r\n\r\n\t\tfunction getMonthLabelPosition(month: Month) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn { x: 3, y: (SQUARE_SIZE * heatmap.value.weekCount) - (SQUARE_SIZE * (month.index)) - (SQUARE_SIZE / 4) };\r\n\t\t\t}\r\n\t\t\treturn { x: SQUARE_SIZE * month.index * 0.96, y: SQUARE_SIZE - SQUARE_BORDER_SIZE };\r\n\t\t}\r\n\r\n\t\twatch([toRef(props, 'rangeColor'), toRef(props, 'darkMode')], ([rc, dm]) => {\r\n\t\t\trangeColor.value = rc || (dm ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT);\r\n\t\t});\r\n\r\n\t\twatch(vertical, v => {\r\n\t\t\tif (v) {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK) + RIGHT_SECTION_WIDTH;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t} else {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t}\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch([width, height], ([w, h]) => (viewbox.value = ` 0 0 ${w} ${h}`), { immediate: true });\r\n\t\twatch([width, height, rangeColor], ([w, h, rc]) => {\r\n\t\t\tlegendWrapperTransform.value = vertical.value\r\n\t\t\t\t? `translate(${LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK)}, ${TOP_SECTION_HEIGHT})`\r\n\t\t\t\t: `translate(${w - (SQUARE_SIZE * rc.length) - 30}, ${h - BOTTOM_SECTION_HEIGHT})`;\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch(locale, l => (lo.value = l ? { ...Heatmap.DEFAULT_LOCALE, ...l } : Heatmap.DEFAULT_LOCALE), { immediate: true });\r\n\t\twatch(rangeColor, rc => (legendViewbox.value = `0 0 ${Heatmap.SQUARE_SIZE * (rc.length + 1)} ${Heatmap.SQUARE_SIZE}`), { immediate: true });\r\n\r\n\t\twatch(\r\n\t\t\t[values, tooltipUnit, tooltipFormatter, noDataText, max, rangeColor],\r\n\t\t\t() => {\r\n\t\t\t\theatmap.value = new Heatmap(props.endDate as Date, props.values, props.max);\r\n\t\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t\t\tnextTick(initTippy);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tonMounted(initTippy);\r\n\t\tonBeforeUnmount(() => {\r\n\t\t\ttippySingleton?.destroy();\r\n\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t});\r\n\r\n\t\tfunction initTippyLazy(e: MouseEvent) {\r\n\t\t\tif (tippySingleton\r\n\t\t\t\t&& e.target\r\n\t\t\t\t&& (e.target as HTMLElement).classList.contains('vch__day__square')\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.weekIndex !== undefined\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.dayIndex !== undefined\r\n\t\t\t) {\r\n\t\t\t\tconst weekIndex = Number((e.target as HTMLElement).dataset.weekIndex),\r\n\t\t\t\t\tdayIndex = Number((e.target as HTMLElement).dataset.dayIndex);\r\n\r\n\t\t\t\tif (!isNaN(weekIndex) && !isNaN(dayIndex)) {\r\n\t\t\t\t\tconst tooltip = tooltipOptions(heatmap.value.calendar[weekIndex][dayIndex]);\r\n\t\t\t\t\tif (tooltip) {\r\n\t\t\t\t\t\tconst instance = tippyInstances.get(e.target as HTMLElement);\r\n\t\t\t\t\t\tif (instance) {\r\n\t\t\t\t\t\t\tinstance.setContent(tooltip);\r\n\t\t\t\t\t\t} else if (!instance) {\r\n\t\t\t\t\t\t\ttippyInstances.set(e.target as HTMLElement, tippy(e.target as HTMLElement, { content: tooltip } as any));\r\n\t\t\t\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tSQUARE_BORDER_SIZE, SQUARE_SIZE, LEFT_SECTION_WIDTH, RIGHT_SECTION_WIDTH, TOP_SECTION_HEIGHT, BOTTOM_SECTION_HEIGHT,\r\n\t\t\tsvg, heatmap, now, width, height, viewbox, daysLabelWrapperTransform, monthsLabelWrapperTransform, yearWrapperTransform, legendWrapperTransform,\r\n\t\t\tlo, legendViewbox, curRangeColor: rangeColor,\r\n\t\t\tgetWeekPosition, getDayPosition, getMonthLabelPosition, initTippyLazy, round: props.round\r\n\t\t};\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.vch__container {\r\n\twidth: 100%;\r\n\tmax-width: 800px;\r\n\tmargin: 40px auto 0 auto;\r\n\tbackground: #fff;\r\n\tborder-radius: 18px;\r\n\tbox-shadow: 0 3px 18px #0001;\r\n\tpadding: 16px 5px 0 5px;\r\n\tbox-sizing: border-box;\r\n}\r\n\r\n.vch__scroll-area {\r\n\toverflow-x: auto;\r\n\t-webkit-overflow-scrolling: touch;\r\n\tscrollbar-width: thin;\r\n}\r\n\r\nsvg.vch__wrapper {\r\n\twidth: 700px;\r\n\tmin-width: 700px;\r\n\tmax-width: 700px;\r\n\tdisplay: block;\r\n\theight: auto;\r\n}\r\n\r\n/* Легенда — в одну строку, всегда под SVG, не в скролле! */\r\n.vch__legend-modern {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tgap: 10px;\r\n\tmargin-top: 10px;\r\n\tmargin-bottom: 0;\r\n\tfont-size: 1em;\r\n\tcolor: #322850;\r\n\tflex-wrap: nowrap;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n.vch__legend-modern-bar {\r\n\tdisplay: flex;\r\n\tgap: 3px;\r\n}\r\n\r\n.vch__legend-modern-box {\r\n\twidth: 18px;\r\n\theight: 12px;\r\n\tborder-radius: 3px;\r\n\tborder: 1px solid #dedede;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n@media (max-width: 800px) {\r\n\t.vch__container {\r\n\t\tmax-width: 100vw;\r\n\t\twidth: 100vw;\r\n\t\tborder-radius: 0;\r\n\t\tpadding: 6px 1px 0 1px;\r\n\t}\r\n\r\n\tsvg.vch__wrapper {\r\n\t\twidth: 700px;\r\n\t\tmin-width: 700px;\r\n\t\tmax-width: 700px;\r\n\t}\r\n}\r\n\r\n@media (max-width: 420px) {\r\n\t.vch__legend-modern {\r\n\t\tfont-size: 0.7em;\r\n\t\tgap: 3px;\r\n\t}\r\n\r\n\t.vch__legend-modern-box {\r\n\t\twidth: 10px;\r\n\t\theight: 7px;\r\n\t}\r\n}\r\n</style>\r\n","<template>\r\n\t<div class=\"vch__container\">\r\n\t\t<div class=\"vch__scroll-area\">\r\n\t\t\t<svg class=\"vch__wrapper\" :viewBox=\"viewbox\">\r\n\t\t\t\t<!-- Месяцы -->\r\n\t\t\t\t<g class=\"vch__months__labels__wrapper\" :transform=\"monthsLabelWrapperTransform\">\r\n\t\t\t\t\t<text class=\"vch__month__label\" v-for=\"(month, index) in heatmap.firstFullWeekOfMonths\" :key=\"index\"\r\n\t\t\t\t\t\t:x=\"getMonthLabelPosition(month).x\" :y=\"getMonthLabelPosition(month).y\">\r\n\t\t\t\t\t\t{{ lo.months[month.value] }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Дни недели -->\r\n\t\t\t\t<g class=\"vch__days__labels__wrapper\" :transform=\"daysLabelWrapperTransform\">\r\n\t\t\t\t\t<text v-for=\"(day, idx) in lo.days\" :key=\"idx\" class=\"vch__day__label\" :x=\"0\"\r\n\t\t\t\t\t\t:y=\"idx * SQUARE_SIZE + SQUARE_SIZE / 1.5\">\r\n\t\t\t\t\t\t{{ day }}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</g>\r\n\t\t\t\t<!-- Календарь -->\r\n\t\t\t\t<g class=\"vch__year__wrapper\" :transform=\"yearWrapperTransform\" @mouseover=\"initTippyLazy\">\r\n\t\t\t\t\t<g class=\"vch__month__wrapper\" v-for=\"(week, weekIndex) in heatmap.calendar\" :key=\"weekIndex\"\r\n\t\t\t\t\t\t:transform=\"getWeekPosition(weekIndex)\">\r\n\t\t\t\t\t\t<template v-for=\"(day, dayIndex) in week\" :key=\"dayIndex\">\r\n\t\t\t\t\t\t\t<rect class=\"vch__day__square\" v-if=\"day.date < now\" :rx=\"round\" :ry=\"round\"\r\n\t\t\t\t\t\t\t\t:transform=\"getDayPosition(dayIndex)\" :width=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\"\r\n\t\t\t\t\t\t\t\t:height=\"SQUARE_SIZE - SQUARE_BORDER_SIZE\" :style=\"{ fill: curRangeColor[day.colorIndex] }\"\r\n\t\t\t\t\t\t\t\t:data-week-index=\"weekIndex\" :data-day-index=\"dayIndex\" @click=\"$emit('dayClick', day)\" />\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</g>\r\n\t\t\t\t</g>\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t\t<div class=\"vch__legend-modern\">\r\n\t\t\t<span>{{ lo.less }}</span>\r\n\t\t\t<div class=\"vch__legend-modern-bar\">\r\n\t\t\t\t<span v-for=\"(color, idx) in curRangeColor\" :key=\"idx\" class=\"vch__legend-modern-box\"\r\n\t\t\t\t\t:style=\"{ background: color }\" />\r\n\t\t\t</div>\r\n\t\t\t<span>{{ lo.more }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, nextTick, onBeforeUnmount, onMounted, PropType, ref, toRef, toRefs, watch } from 'vue';\r\nimport { CalendarItem, Heatmap, Locale, Month, TooltipFormatter, Value } from '@/components/Heatmap';\r\nimport tippy, { createSingleton, CreateSingletonInstance, Instance } from 'tippy.js';\r\nimport 'tippy.js/dist/tippy.css';\r\nimport 'tippy.js/dist/svg-arrow.css';\r\n\r\nexport default /*#__PURE__*/defineComponent({\r\n\tname: 'CalendarHeatmap',\r\n\tprops: {\r\n\t\tendDate: { required: true },\r\n\t\tmax: { type: Number },\r\n\t\trangeColor: { type: Array as PropType<string[]> },\r\n\t\tvalues: { type: Array as PropType<Value[]>, required: true },\r\n\t\tlocale: { type: Object as PropType<Partial<Locale>> },\r\n\t\ttooltip: { type: Boolean, default: true },\r\n\t\ttooltipUnit: { type: String, default: Heatmap.DEFAULT_TOOLTIP_UNIT },\r\n\t\ttooltipFormatter: { type: Function as PropType<TooltipFormatter> },\r\n\t\tvertical: { type: Boolean, default: false },\r\n\t\tnoDataText: { type: [Boolean, String], default: null },\r\n\t\tround: { type: Number, default: 0 },\r\n\t\tdarkMode: Boolean\r\n\t},\r\n\temits: ['dayClick'],\r\n\tsetup(props) {\r\n\t\tconst SQUARE_BORDER_SIZE = Heatmap.SQUARE_SIZE / 5,\r\n\t\t\tSQUARE_SIZE = Heatmap.SQUARE_SIZE + SQUARE_BORDER_SIZE,\r\n\t\t\tLEFT_SECTION_WIDTH = Math.ceil(Heatmap.SQUARE_SIZE * 2.5),\r\n\t\t\tRIGHT_SECTION_WIDTH = SQUARE_SIZE * 3,\r\n\t\t\tTOP_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tBOTTOM_SECTION_HEIGHT = Heatmap.SQUARE_SIZE + (Heatmap.SQUARE_SIZE / 2),\r\n\t\t\tyearWrapperTransform = `translate(${LEFT_SECTION_WIDTH}, ${TOP_SECTION_HEIGHT})`,\r\n\t\t\tsvg = ref<null | SVGElement>(null),\r\n\t\t\tnow = ref(new Date()),\r\n\t\t\theatmap = ref(new Heatmap(props.endDate as Date, props.values, props.max)),\r\n\t\t\twidth = ref(0),\r\n\t\t\theight = ref(0),\r\n\t\t\tviewbox = ref('0 0 0 0'),\r\n\t\t\tlegendViewbox = ref('0 0 0 0'),\r\n\t\t\tdaysLabelWrapperTransform = ref(''),\r\n\t\t\tmonthsLabelWrapperTransform = ref(''),\r\n\t\t\tlegendWrapperTransform = ref(''),\r\n\t\t\tlo = ref<Locale>({} as any),\r\n\t\t\trangeColor = ref<string[]>(props.rangeColor || (props.darkMode ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT));\r\n\r\n\t\tconst { values, tooltipUnit, tooltipFormatter, noDataText, max, vertical, locale } = toRefs(props),\r\n\t\t\ttippyInstances = new Map<HTMLElement, Instance>();\r\n\r\n\t\tlet tippySingleton: CreateSingletonInstance;\r\n\r\n\t\tfunction initTippy() {\r\n\t\t\ttippyInstances.clear();\r\n\t\t\tif (tippySingleton) {\r\n\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t} else {\r\n\t\t\t\ttippySingleton = createSingleton(Array.from(tippyInstances.values()), {\r\n\t\t\t\t\toverrides: [],\r\n\t\t\t\t\tmoveTransition: 'transform 0.1s ease-out',\r\n\t\t\t\t\tallowHTML: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction tooltipOptions(day: CalendarItem) {\r\n\t\t\tif (props.tooltip) {\r\n\t\t\t\tif (day.count !== undefined) {\r\n\t\t\t\t\tif (props.tooltipFormatter) {\r\n\t\t\t\t\t\treturn props.tooltipFormatter(day, props.tooltipUnit!);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn `<b>${day.count} ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t} else if (props.noDataText) {\r\n\t\t\t\t\treturn `${props.noDataText}`;\r\n\t\t\t\t} else if (props.noDataText !== false) {\r\n\t\t\t\t\treturn `<b>No ${props.tooltipUnit}</b> ${lo.value.on} ${lo.value.months[day.date.getMonth()]} ${day.date.getDate()}, ${day.date.getFullYear()}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tfunction getWeekPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(0, ${(SQUARE_SIZE * heatmap.value.weekCount) - ((index + 1) * SQUARE_SIZE)})`;\r\n\t\t\t}\r\n\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t}\r\n\r\n\t\tfunction getDayPosition(index: number) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn `translate(${index * SQUARE_SIZE}, 0)`;\r\n\t\t\t}\r\n\t\t\treturn `translate(0, ${index * SQUARE_SIZE})`;\r\n\t\t}\r\n\r\n\t\tfunction getMonthLabelPosition(month: Month) {\r\n\t\t\tif (props.vertical) {\r\n\t\t\t\treturn { x: 3, y: (SQUARE_SIZE * heatmap.value.weekCount) - (SQUARE_SIZE * (month.index)) - (SQUARE_SIZE / 4) };\r\n\t\t\t}\r\n\t\t\treturn { x: SQUARE_SIZE * month.index * 0.96, y: SQUARE_SIZE - SQUARE_BORDER_SIZE };\r\n\t\t}\r\n\r\n\t\twatch([toRef(props, 'rangeColor'), toRef(props, 'darkMode')], ([rc, dm]) => {\r\n\t\t\trangeColor.value = rc || (dm ? Heatmap.DEFAULT_RANGE_COLOR_DARK : Heatmap.DEFAULT_RANGE_COLOR_LIGHT);\r\n\t\t});\r\n\r\n\t\twatch(vertical, v => {\r\n\t\t\tif (v) {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK) + RIGHT_SECTION_WIDTH;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t} else {\r\n\t\t\t\twidth.value = LEFT_SECTION_WIDTH + (SQUARE_SIZE * heatmap.value.weekCount) + SQUARE_BORDER_SIZE;\r\n\t\t\t\theight.value = TOP_SECTION_HEIGHT + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK);\r\n\t\t\t\tdaysLabelWrapperTransform.value = `translate(0, ${TOP_SECTION_HEIGHT})`;\r\n\t\t\t\tmonthsLabelWrapperTransform.value = `translate(${LEFT_SECTION_WIDTH}, 0)`;\r\n\t\t\t}\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch([width, height], ([w, h]) => (viewbox.value = ` 0 0 ${w} ${h}`), { immediate: true });\r\n\t\twatch([width, height, rangeColor], ([w, h, rc]) => {\r\n\t\t\tlegendWrapperTransform.value = vertical.value\r\n\t\t\t\t? `translate(${LEFT_SECTION_WIDTH + (SQUARE_SIZE * Heatmap.DAYS_IN_WEEK)}, ${TOP_SECTION_HEIGHT})`\r\n\t\t\t\t: `translate(${w - (SQUARE_SIZE * rc.length) - 30}, ${h - BOTTOM_SECTION_HEIGHT})`;\r\n\t\t}, { immediate: true });\r\n\r\n\t\twatch(locale, l => (lo.value = l ? { ...Heatmap.DEFAULT_LOCALE, ...l } : Heatmap.DEFAULT_LOCALE), { immediate: true });\r\n\t\twatch(rangeColor, rc => (legendViewbox.value = `0 0 ${Heatmap.SQUARE_SIZE * (rc.length + 1)} ${Heatmap.SQUARE_SIZE}`), { immediate: true });\r\n\r\n\t\twatch(\r\n\t\t\t[values, tooltipUnit, tooltipFormatter, noDataText, max, rangeColor],\r\n\t\t\t() => {\r\n\t\t\t\theatmap.value = new Heatmap(props.endDate as Date, props.values, props.max);\r\n\t\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t\t\tnextTick(initTippy);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tonMounted(initTippy);\r\n\t\tonBeforeUnmount(() => {\r\n\t\t\ttippySingleton?.destroy();\r\n\t\t\ttippyInstances.forEach((item) => item.destroy());\r\n\t\t});\r\n\r\n\t\tfunction initTippyLazy(e: MouseEvent) {\r\n\t\t\tif (tippySingleton\r\n\t\t\t\t&& e.target\r\n\t\t\t\t&& (e.target as HTMLElement).classList.contains('vch__day__square')\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.weekIndex !== undefined\r\n\t\t\t\t&& (e.target as HTMLElement).dataset.dayIndex !== undefined\r\n\t\t\t) {\r\n\t\t\t\tconst weekIndex = Number((e.target as HTMLElement).dataset.weekIndex),\r\n\t\t\t\t\tdayIndex = Number((e.target as HTMLElement).dataset.dayIndex);\r\n\r\n\t\t\t\tif (!isNaN(weekIndex) && !isNaN(dayIndex)) {\r\n\t\t\t\t\tconst tooltip = tooltipOptions(heatmap.value.calendar[weekIndex][dayIndex]);\r\n\t\t\t\t\tif (tooltip) {\r\n\t\t\t\t\t\tconst instance = tippyInstances.get(e.target as HTMLElement);\r\n\t\t\t\t\t\tif (instance) {\r\n\t\t\t\t\t\t\tinstance.setContent(tooltip);\r\n\t\t\t\t\t\t} else if (!instance) {\r\n\t\t\t\t\t\t\ttippyInstances.set(e.target as HTMLElement, tippy(e.target as HTMLElement, { content: tooltip } as any));\r\n\t\t\t\t\t\t\ttippySingleton.setInstances(Array.from(tippyInstances.values()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tSQUARE_BORDER_SIZE, SQUARE_SIZE, LEFT_SECTION_WIDTH, RIGHT_SECTION_WIDTH, TOP_SECTION_HEIGHT, BOTTOM_SECTION_HEIGHT,\r\n\t\t\tsvg, heatmap, now, width, height, viewbox, daysLabelWrapperTransform, monthsLabelWrapperTransform, yearWrapperTransform, legendWrapperTransform,\r\n\t\t\tlo, legendViewbox, curRangeColor: rangeColor,\r\n\t\t\tgetWeekPosition, getDayPosition, getMonthLabelPosition, initTippyLazy, round: props.round\r\n\t\t};\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.vch__container {\r\n\twidth: 100%;\r\n\tmax-width: 800px;\r\n\tmargin: 40px auto 0 auto;\r\n\tbackground: #fff;\r\n\tborder-radius: 18px;\r\n\tbox-shadow: 0 3px 18px #0001;\r\n\tpadding: 16px 5px 0 5px;\r\n\tbox-sizing: border-box;\r\n}\r\n\r\n.vch__scroll-area {\r\n\toverflow-x: auto;\r\n\t-webkit-overflow-scrolling: touch;\r\n\tscrollbar-width: thin;\r\n}\r\n\r\nsvg.vch__wrapper {\r\n\twidth: 700px;\r\n\tmin-width: 700px;\r\n\tmax-width: 700px;\r\n\tdisplay: block;\r\n\theight: auto;\r\n}\r\n\r\n/* Легенда — в одну строку, всегда под SVG, не в скролле! */\r\n.vch__legend-modern {\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tjustify-content: center;\r\n\tgap: 10px;\r\n\tmargin-top: 10px;\r\n\tmargin-bottom: 0;\r\n\tfont-size: 1em;\r\n\tcolor: #322850;\r\n\tflex-wrap: nowrap;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n.vch__legend-modern-bar {\r\n\tdisplay: flex;\r\n\tgap: 3px;\r\n}\r\n\r\n.vch__legend-modern-box {\r\n\twidth: 18px;\r\n\theight: 12px;\r\n\tborder-radius: 3px;\r\n\tborder: 1px solid #dedede;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n@media (max-width: 800px) {\r\n\t.vch__container {\r\n\t\tmax-width: 100vw;\r\n\t\twidth: 100vw;\r\n\t\tborder-radius: 0;\r\n\t\tpadding: 6px 1px 0 1px;\r\n\t}\r\n\r\n\tsvg.vch__wrapper {\r\n\t\twidth: 700px;\r\n\t\tmin-width: 700px;\r\n\t\tmax-width: 700px;\r\n\t}\r\n}\r\n\r\n@media (max-width: 420px) {\r\n\t.vch__legend-modern {\r\n\t\tfont-size: 0.7em;\r\n\t\tgap: 3px;\r\n\t}\r\n\r\n\t.vch__legend-modern-box {\r\n\t\twidth: 10px;\r\n\t\theight: 7px;\r\n\t}\r\n}\r\n</style>\r\n","import { App } from 'vue';\r\nimport CalendarHeatmap from '@/components/CalendarHeatmap.vue';\r\n\r\nfunction install(Vue: App) {\r\n\tVue.component(CalendarHeatmap.name!, CalendarHeatmap);\r\n}\r\n\r\nexport default { install };\r\nexport * from '@/components/Heatmap';\r\nexport { default as CalendarHeatmap } from '@/components/CalendarHeatmap.vue';\r\n"],"names":["_Heatmap","endDate","values","max","__publicField","day","v","i","len","date","j","dayValues","cal","index","lastWeek","currentWeek","count","numDays","newDate","entry","Heatmap","_sfc_main","defineComponent","props","SQUARE_BORDER_SIZE","SQUARE_SIZE","LEFT_SECTION_WIDTH","RIGHT_SECTION_WIDTH","TOP_SECTION_HEIGHT","BOTTOM_SECTION_HEIGHT","yearWrapperTransform","svg","ref","now","heatmap","width","height","viewbox","legendViewbox","daysLabelWrapperTransform","monthsLabelWrapperTransform","legendWrapperTransform","lo","rangeColor","tooltipUnit","tooltipFormatter","noDataText","vertical","locale","toRefs","tippyInstances","tippySingleton","initTippy","createSingleton","tooltipOptions","getWeekPosition","getDayPosition","getMonthLabelPosition","month","watch","toRef","rc","dm","w","h","l","item","nextTick","onMounted","onBeforeUnmount","initTippyLazy","e","weekIndex","dayIndex","tooltip","instance","tippy","_hoisted_9","_hoisted_10","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_openBlock","_Fragment","_renderList","_hoisted_4","idx","_hoisted_6","args","week","_hoisted_3","_hoisted_11","_toDisplayString","_hoisted_12","color","install","Vue","CalendarHeatmap"],"mappings":"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"}